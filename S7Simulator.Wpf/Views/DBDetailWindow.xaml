<Window x:Class="S7Simulator.Wpf.Views.DBDetailWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="DB变量详情" Height="650" Width="1200">
    <Grid Margin="10">
        <DataGrid ItemsSource="{Binding Variables}" 
                  AutoGenerateColumns="False" 
                  CanUserAddRows="False"
                  GridLinesVisibility="All"
                  AlternatingRowBackground="#FFF5F5F5">
            <DataGrid.Columns>
                <DataGridTextColumn Header="变量名" Binding="{Binding Name}" Width="160" IsReadOnly="True"/>
                <DataGridTextColumn Header="地址" Binding="{Binding Address}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="类型" Binding="{Binding DataType}" Width="80" IsReadOnly="True"/>

                <!-- 当前值（可编辑） -->
                <DataGridTemplateColumn Header="当前值" Width="140">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <ContentControl Content="{Binding}">
                                <ContentControl.Style>
                                    <Style TargetType="ContentControl">
                                        <Setter Property="ContentTemplate">
                                            <Setter.Value>
                                                <!-- Bool 用 CheckBox -->
                                                <DataTemplate>
                                                    <CheckBox IsChecked="{Binding CurrentValue, Converter={StaticResource BoolConverter}, UpdateSourceTrigger=PropertyChanged}"
                                                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </DataTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataType}" Value="BOOL">
                                                <Setter Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <CheckBox IsChecked="{Binding CurrentValue, Converter={StaticResource BoolConverter}, UpdateSourceTrigger=PropertyChanged}"
                                                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding DataType}" Value="STRING">
                                                <Setter Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <TextBox Text="{Binding CurrentValue, UpdateSourceTrigger=LostFocus}" 
                                                                     MinWidth="120"/>
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding DataType}" Value="REAL">
                                                <Setter Property="ContentTemplate">
                                                    <Setter.Value>
                                                        <DataTemplate>
                                                            <TextBox Text="{Binding CurrentValue, UpdateSourceTrigger=LostFocus}" 
                                                                     MinWidth="120">
                                                                <TextBox.Style>
                                                                    <Style TargetType="TextBox">
                                                                        <EventSetter Event="PreviewTextInput" Handler="NumberValidationTextBox"/>
                                                                    </Style>
                                                                </TextBox.Style>
                                                            </TextBox>
                                                        </DataTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </ContentControl.Style>
                            </ContentControl>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <DataGridTextColumn Header="初始值" Binding="{Binding InitialValue}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="注释" Binding="{Binding Comment}" Width="*" IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Window>